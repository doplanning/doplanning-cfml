var curAreaId=0;var areaWithLink=false;var currentTab="#tab1";var disableNextTabChange=false;function windowHeight(){var de=document.documentElement;return de.clientHeight}function getURLParameterFromPath(name,path){return decodeURIComponent((new RegExp("[?|&]"+name+"=([^&;]+?)(&|#|;|$)").exec(path)||[,""])[1].replace(/\+/g,"%20"))||null}function getFilename(url){return url.substring(url.lastIndexOf("/")+1)}function showAlertMessage(msg,res){if($("#alertContainer span").length!=0){$("#alertContainer span").remove()}if(res==true){$("#alertContainer").attr("class","alert alert-success")}else{$("#alertContainer").attr("class","alert alert-error")}$("#alertContainer button").after("<span>"+msg+"</span>");$("#alertContainer").fadeIn("slow");setTimeout(function(){hideAlertMessage()},9500)}function hideAlertMessage(){$("#alertContainer").fadeOut("slow")}function loadModal(url){$("body").modalmanager("loading");$modal.load(url,"",function(){$modal.modal({width:630})})}function hideModal(modalId){$(modalId).modal("hide")}function hideDefaultModal(){$modal.modal("hide")}function postModalForm(formId,requestUrl,responseUrl,responseTarget){$("body").modalmanager("loading");$.ajax({type:"POST",url:requestUrl,data:$(formId).serialize(),success:function(data,status){if(status=="success"){var message=data.message;openUrl(responseUrl);hideDefaultModal();$("body").modalmanager("removeLoading");showAlertMessage(message,data.result)}else{alert(status)}},dataType:"json"})}function postModalFormTree(formId,requestUrl){$("body").modalmanager("loading");$.ajax({type:"POST",url:requestUrl,data:$(formId).serialize(),success:function(data,status){if(status=="success"){var message=data.message;hideDefaultModal();if(formId!="#deleteAreaForm"){disableNextTabChange=true;updateTreeWithSelectedArea(data.area_id)}else{updateTreeWithSelectedArea()}$("body").modalmanager("removeLoading");showAlertMessage(message,data.result)}else{alert(status)}},dataType:"json"})}function openUrl(url,target){if(target=="itemIframe"){if(currentTab=="#tab3"){loadIframeSearchItemPage(url)}else{loadIframeItemPage(url)}}else{if(target=="userAreaIframe"||target=="userAdminIframe"){$("#"+target).attr("src","iframes/"+getFilename(url))}else{if(target=="logItemIframe"){$("#"+target).attr("src","iframes/"+getFilename(url))}else{if(target=="areaIframe"){if(currentTab!="#tab2"){$('#dpTab a[href="#tab2"]').tab("show");iframePage=url;var urAreaId=getURLParameterFromPath("area",url);selectTreeNode(urAreaId)}else{loadIframePage(url)}}else{loadIframePage(url)}}}}}function loadIframePage(page){$("#areaIframe").attr("src","iframes/"+getFilename(page))}function loadIframeItemPage(page){$("#itemIframe").attr("src","iframes2/"+getFilename(page))}function loadIframeSearchItemPage(page){$("#searchItemIframe").attr("src","iframes2/"+getFilename(page))}function areaIframeLoaded(){}function setWithLink(value){areaWithLink=value;if(value==true){$("#areaImageAnchor").css("cursor","pointer")}else{$("#areaImageAnchor").css("cursor","default")}}function loadTree(){curAreaId=undefined;$("#loadingContainer").show();$("#treeContainer").css("visibility","hidden");var noCacheNumber=Math.floor(Math.random()*1001);$("#treeContainer").load("html_content/tree.cfm?n="+noCacheNumber,function(){showTree(true)})}function updateTree(){loadTree()}function updateTreeWithSelectedArea(areaId){selectAreaId=areaId;loadTree()}function selectTreeNode(nodeId){$("#areasTreeContainer").jstree("select_node","#"+nodeId,true)}function areaSelected(areaId,areaUrl,withLink){curAreaId=areaId;loadAreaImage(areaId);setWithLink(withLink);if(iframePage.length>0){loadIframePage(iframePage);iframePage=""}else{loadIframePage(areaUrl)}if(disableNextTabChange){disableNextTabChange=false}else{if(!$("#changeTabDisabled").is(":checked")){$('#dpTab a[href="#tab2"]').tab("show")}}}function searchTextInTree(){searchInTree(document.getElementById("searchText").value)};