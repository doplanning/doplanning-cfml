/* updated 10/31/2015 (v2.24.0) */
(function(c){var b=c.tablesorter,a=".tscolsel",d=b.columnSelector={queryAll:"@media only all { [columns] { display: none; } } ",queryBreak:"@media all and (min-width: [size]) { [columns] { display: table-cell; } } ",init:function(g,i,e){var h,f;h=c(e.columnSelector_layout);if(!h.find("input").add(h.filter("input")).length){if(i.debug){console.error("ColumnSelector: >> ERROR: Column Selector aborting, no input found in the layout! ***")}return}i.$table.addClass(i.namespace.slice(1)+"columnselector");f=i.selector={$container:c(e.columnSelector_container||"<div>")};f.$style=c("<style></style>").prop("disabled",true).appendTo("head");f.$breakpoints=c("<style></style>").prop("disabled",true).appendTo("head");f.isInitializing=true;d.setUpColspan(i,e);d.setupSelector(i,e);if(e.columnSelector_mediaquery){d.setupBreakpoints(i,e)}f.isInitializing=false;if(f.$container.length){d.updateCols(i,e)}else{if(i.debug){console.warn("ColumnSelector: >> container not found")}}i.$table.off("refreshColumnSelector"+a).on("refreshColumnSelector"+a,function(k,l,j){d.refreshColumns(this.config,l,j)})},refreshColumns:function(l,k,h){var e,g,j=c.isArray(h||k),f=l.widgetOptions;if(typeof k!=="undefined"&&l.selector.$container.length){if(k==="selectors"){l.selector.$container.empty();d.setupSelector(l,f);d.setupBreakpoints(l,f);if(typeof h==="undefined"){h=l.selector.auto}}if(j){g=h||k;c.each(g,function(n,m){g[n]=parseInt(m,10)});for(e=0;e<l.columns;e++){l.selector.$container.find("input[data-column="+e+"]").prop("checked",c.inArray(e,g)>=0)}}d.updateAuto(l,f,l.selector.$container.find('input[data-column="auto"]').prop("checked",h===true||k===true||k==="auto"&&h!==false))}else{d.updateBreakpoints(l,f);d.updateCols(l,f)}d.adjustColspans(l,f)},setupSelector:function(k,m){var j,g,e,n,i,h,l=k.selector,q=l.$container,o=m.columnSelector_saveColumns&&b.storage,p=o?b.storage(k.table,"tablesorter-columnSelector"):[],f=o?b.storage(k.table,"tablesorter-columnSelector-auto"):{};l.auto=c.isEmptyObject(f)||c.type(f.auto)!=="boolean"?m.columnSelector_mediaqueryState:f.auto;l.states=[];l.$column=[];l.$wrapper=[];l.$checkbox=[];for(j=0;j<k.columns;j++){e=k.$headerIndexed[j];n=e.attr(m.columnSelector_priority)||1;h=e.attr("data-column");i=b.getColumnData(k.table,k.headers,h);f=b.getData(e,i,"columnSelector");if(isNaN(n)&&n.length>0||f==="disable"||(m.columnSelector_columns[h]&&m.columnSelector_columns[h]==="disable")){continue}l.states[h]=p&&typeof p[h]!=="undefined"?p[h]:typeof m.columnSelector_columns[h]!=="undefined"?m.columnSelector_columns[h]:(f==="true"||f!=="false");l.$column[h]=c(this);g=e.attr(m.columnSelector_name)||e.text();if(q.length){l.$wrapper[h]=c(m.columnSelector_layout.replace(/\{name\}/g,g)).appendTo(q);l.$checkbox[h]=l.$wrapper[h].find("input").add(l.$wrapper[h].filter("input")).attr("data-column",h).toggleClass(m.columnSelector_cssChecked,l.states[h]).prop("checked",l.states[h]).on("change",function(){var r=c(this).attr("data-column");k.selector.states[r]=this.checked;d.updateCols(k,m)}).change()}}},setupBreakpoints:function(g,e){var f=g.selector;if(e.columnSelector_mediaquery){f.lastIndex=-1;d.updateBreakpoints(g,e);g.$table.off("updateAll"+a).on("updateAll"+a,function(){d.updateBreakpoints(g,e);d.updateCols(g,e)})}if(f.$container.length){if(e.columnSelector_mediaquery){f.$auto=c(e.columnSelector_layout.replace(/\{name\}/g,e.columnSelector_mediaqueryName)).prependTo(f.$container);f.$auto.find("input").add(f.$auto.filter("input")).attr("data-column","auto").prop("checked",f.auto).toggleClass(e.columnSelector_cssChecked,f.auto).on("change",function(){d.updateAuto(g,e,c(this))}).change()}g.$table.off("update"+a).on("update"+a,function(){d.updateCols(g,e)})}},updateAuto:function(h,f,e){var g=h.selector;g.auto=e.prop("checked")||false;c.each(g.$checkbox,function(j,k){if(k){k[0].disabled=g.auto;g.$wrapper[j].toggleClass("disabled",g.auto)}});if(f.columnSelector_mediaquery){d.updateBreakpoints(h,f)}d.updateCols(h,f);if(h.selector.$popup){h.selector.$popup.find(".tablesorter-column-selector").html(g.$container.html()).find("input").each(function(){var i=c(this).attr("data-column");c(this).prop("checked",i==="auto"?g.auto:g.states[i])})}if(f.columnSelector_saveColumns&&b.storage){b.storage(h.$table[0],"tablesorter-columnSelector-auto",{auto:g.auto})}d.adjustColspans(h,f);if(g.auto){h.$table.triggerHandler(f.columnSelector_updated)}},addSelectors:function(g,f){var h=[],e=" col:nth-child("+f+")";h.push(g+e+","+g+"_extra_table"+e);e=" tr th:nth-child("+f+")";h.push(g+e+","+g+"_extra_table"+e);e=" tr td:nth-child("+f+")";h.push(g+e+","+g+"_extra_table"+e);return h},updateBreakpoints:function(j,m){var n,f,h,k,e=[],l=j.selector,i=j.namespace+"columnselector",g=[],o="";if(m.columnSelector_mediaquery&&!l.auto){l.$breakpoints.prop("disabled",true);l.$style.prop("disabled",false);return}if(m.columnSelector_mediaqueryHidden){for(h=0;h<j.columns;h++){f=b.getColumnData(j.table,j.headers,h);e[h+1]=b.getData(j.$headerIndexed[h],f,"columnSelector")==="false";if(e[h+1]){g=g.concat(d.addSelectors(i,h+1))}}}for(n=0;n<6;n++){k=[];j.$headers.filter("["+m.columnSelector_priority+"="+(n+1)+"]").each(function(){h=parseInt(c(this).attr("data-column"),10)+1;if(!e[h]){k=k.concat(d.addSelectors(i,h))}});if(k.length){g=g.concat(k);o+=d.queryBreak.replace(/\[size\]/g,m.columnSelector_breakpoints[n]).replace(/\[columns\]/g,k.join(","))}}if(l.$style){l.$style.prop("disabled",true)}if(g.length){l.$breakpoints.prop("disabled",false).html(d.queryAll.replace(/\[columns\]/g,g.join(","))+o)}},updateCols:function(j,f){if(f.columnSelector_mediaquery&&j.selector.auto||j.selector.isInitializing){return}var e,h=j.selector,g=[],i=j.namespace+"columnselector";h.$container.find("input[data-column]").filter('[data-column!="auto"]').each(function(){if(!this.checked){e=parseInt(c(this).attr("data-column"),10)+1;g=g.concat(d.addSelectors(i,e))}c(this).toggleClass(f.columnSelector_cssChecked,this.checked)});if(f.columnSelector_mediaquery){h.$breakpoints.prop("disabled",true)}if(h.$style){h.$style.prop("disabled",false).html(g.length?g.join(",")+" { display: none; }":"")}if(f.columnSelector_saveColumns&&b.storage){b.storage(j.$table[0],"tablesorter-columnSelector",h.states)}d.adjustColspans(j,f);j.$table.triggerHandler(f.columnSelector_updated)},setUpColspan:function(h,k){var g,l,j,e=c(window),i=false,m=h.$table.add(c(h.namespace+"_extra_table")).children("thead, tfoot").children("tr").children("th, td"),f=m.length;for(g=0;g<f;g++){l=m[g].colSpan;if(l>1){i=true;m.eq(g).addClass(h.namespace.slice(1)+"columnselectorHasSpan").attr("data-col-span",l)}}if(i&&k.columnSelector_mediaquery){j=h.namespace.slice(1)+"columnselector";e.off(j).on("resize"+j,b.window_resize).on("resizeEnd"+j,function(){e.off("resize"+j,b.window_resize);d.adjustColspans(h,k);e.on("resize"+j,b.window_resize)})}},adjustColspans:function(j,n){var i,k,e,o,g,m=j.selector,f=m.auto,l=c(j.namespace+"columnselectorHasSpan"),h=l.length;if(h){for(i=0;i<h;i++){e=parseInt(l.eq(i).attr("data-column"),10);o=parseInt(l.eq(i).attr("data-col-span"),10);g=e+o;for(k=e;k<g;k++){if(!f&&m.states[k]===false||f&&j.$headerIndexed[k]&&!j.$headerIndexed[k].is(":visible")){o--}}if(o){l.eq(i).show()[0].colSpan=o}else{l.eq(i).hide()}}}},attachTo:function(h,k){h=c(h)[0];var g,e,f,j=h.config,i=c(k);if(i.length&&j){if(!i.find(".tablesorter-column-selector").length){i.append('<span class="tablesorter-column-selector"></span>')}g=j.selector;e=j.widgetOptions;i.find(".tablesorter-column-selector").html(g.$container.html()).find("input").each(function(){var l=c(this).attr("data-column"),m=l==="auto"?g.auto:g.states[l];c(this).toggleClass(e.columnSelector_cssChecked,m).prop("checked",m)});g.$popup=i.on("change","input",function(){f=c(this).toggleClass(e.columnSelector_cssChecked,this.checked).attr("data-column");g.$container.find('input[data-column="'+f+'"]').prop("checked",this.checked).trigger("change")})}}};b.window_resize=function(){if(b.timer_resize){clearTimeout(b.timer_resize)}b.timer_resize=setTimeout(function(){c(window).trigger("resizeEnd")},250)};b.addWidget({id:"columnSelector",priority:10,options:{columnSelector_container:null,columnSelector_columns:{},columnSelector_saveColumns:true,columnSelector_layout:'<label><input type="checkbox">{name}</label>',columnSelector_name:"data-selector-name",columnSelector_mediaquery:true,columnSelector_mediaqueryName:"Auto: ",columnSelector_mediaqueryState:true,columnSelector_mediaqueryHidden:false,columnSelector_breakpoints:["20em","30em","40em","50em","60em","70em"],columnSelector_priority:"data-priority",columnSelector_cssChecked:"checked",columnSelector_updated:"columnUpdate"},init:function(g,f,h,e){d.init(g,h,e)},remove:function(f,i,e,h){if(h){return}var g=i.selector;g.$container.empty();if(g.$popup){g.$popup.empty()}g.$style.remove();g.$breakpoints.remove();i.$table.off("updateAll"+a+" update"+a)}})})(jQuery);
